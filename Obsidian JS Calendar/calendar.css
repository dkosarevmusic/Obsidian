@keyframes ojsc-flash {
    0% { opacity: 0; }
    20% { opacity: 0.7; } /* Пик вспышки */
    100% { opacity: 0; }
}

/* Flash animation for items being saved or updated */
.ojsc-task-item-saving,
.ojsc-task-item-updating {
    position: relative;
    z-index: 1;
}
.ojsc-task-item-saving::before,
.ojsc-task-item-updating::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: white;
    border-radius: 4px;
    opacity: 0;
    animation: ojsc-flash 1.2s infinite ease-out;
    z-index: 2;
}

.ojsc-container {
    width: 100%;
    margin-top: 20px;
    /* Стили для цветной обводки */
    border: 2px solid transparent;
    border-radius: 8px;
    padding: 5px;
    transition: border-color 0.3s ease;
}

/* Цвета обводки в зависимости от режима */
.ojsc-status-mode-work { border-color: gold; }
.ojsc-status-mode-done { border-color: limegreen; }
.ojsc-status-mode-cancelled { border-color: tomato; }
.ojsc-status-mode-postpone { border-color: dodgerblue; }


.ojsc-footer {
    text-align: right;
    font-size: 0.8em;
    color: var(--text-muted);
    margin-top: 10px;
    padding-right: 5px;
}

.ojsc-calendar-header { 
    display: flex; 
    flex-direction: column; /* Заголовок и контролы теперь в столбце */
    align-items: stretch; /* Растягиваем на всю ширину */
    margin-bottom: 5px; 
    gap: 8px; /* Отступ между заголовком и панелью управления */
    padding: 8px 12px; 
    background-color: var(--background-secondary); 
    border-radius: 6px; 
}
.ojsc-controls-wrapper { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
.ojsc-main-nav-group, .ojsc-view-controls-group { 
    display: flex; 
    gap: 5px; 
    align-items: center; /* Главное правило для вертикального выравнивания */
}
.ojsc-calendar-header select, .ojsc-calendar-header button { 
    background-color: var(--background-modifier-form-field); 
    color: var(--text-normal); 
    border: 1px solid var(--background-modifier-border); 
    border-radius: 4px; 
    padding: 4px; 
    height: 32px;
    box-sizing: border-box;
}
.ojsc-calendar-header select {
    text-align: center;
    text-align-last: center;
}
.ojsc-calendar-header h2 { margin: 0; text-transform: capitalize; color: white; text-align: center; }
.ojsc-container .ojsc-multi-month-header { 
    text-align: center; 
    text-transform: capitalize; 
    margin-top: 20px; 
    margin-bottom: 5px; 
    background-color: var(--background-secondary);
    color: var(--text-accent);
    padding: 6px 0;
    border-radius: 6px;
}
/* Убираем верхний отступ у самого первого заголовка месяца в многомесячных видах */
.ojsc-multi-month-header:first-of-type {
    margin-top: 0;
}

.ojsc-day-card {
    border: 1px solid var(--background-modifier-border);
    border-radius: 6px;
    /* Возвращаем небольшой боковой отступ для общего вида, но будем его компенсировать. */
    padding: 8px 4px;
    background-color: var(--background-secondary);
    flex: 1;
    min-width: 0; /* Предотвращает переполнение контентом */
    display: flex;
    flex-direction: column;
}
.ojsc-day-card.ojsc-today {
    border-color: var(--text-accent);
}
.ojsc-day-card.ojsc-drop-target {
    background-color: var(--background-modifier-hover);
    border-style: solid;
    border-color: var(--text-accent);
}
.ojsc-day-card-header {
    font-weight: bold;
    margin-bottom: 4px;
    /* Заголовку теперь нужен меньший отступ, так как у родителя есть свой. */
    padding: 0 4px;
}
.ojsc-day-card .ojsc-task-list {
    list-style: none;
    padding: 0;
    /* Используем отрицательный margin, чтобы "выйти" за пределы padding родителя.
       Это позволяет списку задач занимать всю ширину, убирая лишний отступ слева. */
    margin: 4px -4px 0 -4px;
    font-size: 0.9em;
}
.ojsc-day-card .ojsc-task-item {
    margin-bottom: 4px;
    /* Устанавливаем симметричные отступы для текста внутри задачи. */
    /* Уменьшаем отрицательный отступ, чтобы сдвинуть элемент немного правее. */
    margin-left: 4px;
    /* Добавляем внешний отступ справа, чтобы сдвинуть правый край плашки левее. */
    margin-right: 4px;
    padding: 1px 3px;
    border-radius: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
/* Стиль для элемента, который перетаскивается на мобильных */
.ojsc-task-item.ojsc-dragging {
    opacity: 0.5; /* Оставляем только полупрозрачность для консистентности */
    /* border-style: dashed; - Убираем пунктирную рамку */
}
/* Стиль для подсветки "важных" задач. Накладывается поверх цвета Area. */
.ojsc-task-item.ojsc-task-item-important {
    position: relative;
}
.ojsc-task-item.ojsc-task-item-important::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 3px;
    bottom: 0;
    background-color: hsl(0, 80%, 50%);
    z-index: 1; /* Places it above the text content */
    pointer-events: none; /* Allows clicks to pass through */
}

/* Стили для сеток (месяц, год) */
.ojsc-month-container { margin-bottom: 20px; }
.ojsc-weekdays-header {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px; /* Отступ между плашками */
    margin-bottom: 5px;
}
.ojsc-weekday {
    background-color: var(--background-secondary);
    color: var(--text-muted);
    padding: 4px 0;
    border-radius: 4px;
    text-align: center;
    font-size: 0.85em;
    font-weight: 600;
}
.ojsc-weekday.ojsc-weekend {
    color: var(--text-accent);
}
.ojsc-month-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
}
.ojsc-month-grid-card {
    min-height: 100px;
    padding: 4px;
}
.ojsc-month-grid-card .ojsc-day-card-header {
    font-size: 0.9em;
    text-align: right;
}
.ojsc-month-grid-card.ojsc-other-month {
    opacity: 0.5;
}
/* Индикация текущего дня в сеточных видах (месяц, год).
   Вместо круга, который влияет на размер ячейки, просто выделяем цифру цветом и жирностью. */
.ojsc-today-number {
    color: var(--text-accent);
    font-weight: 700; /* Делаем цифру жирнее для акцента */
    padding: 0 2px; /* Небольшой отступ, чтобы не прилипало к краю */
}
.ojsc-clickable-day {
    cursor: pointer;
    transition: background-color 0.2s ease-in-out;
    border-radius: 4px;
    background-color: var(--background-modifier-form-field); /* Постоянное выделение */
    margin: -2px; /* Компенсируем padding родителя, чтобы ховер был красивее */
    padding: 2px; /* Возвращаем внутренний отступ */
}
.ojsc-clickable-day:hover {
    background-color: var(--background-modifier-hover);
}

/* --- Кастомные сдвиги для разных режимов --- */
/* Для месячного вида, компенсируем padding: 4px у .ojsc-month-grid-card */
.ojsc-month-grid .ojsc-task-item {
    margin-left: 4px; /* Сдвиг вправо на 1px */
}

/* --- Адаптивность для мобильных устройств --- */
@media (max-width: 650px) {
    .ojsc-controls-wrapper {
        flex-direction: column; /* Все контролы в столбец */
        gap: 8px;
    }
    .ojsc-view-controls-group {
        order: 2; /* Селекторы идут после кнопок навигации */
        justify-content: center; /* Центрируем селекторы */
    }
    .ojsc-main-nav-group {
        order: 1; /* Кнопки навигации идут первыми под заголовком */
        justify-content: space-between; /* Распределяем кнопки по ширине */
    }
}

/* Day card header color coding for task areas */

/* For grid views (month, year) - "clickable plates" */
.ojsc-day-work .ojsc-clickable-day {
    box-shadow: inset 0 3px 0 0 hsl(30, 100%, 50%);
}

.ojsc-day-skills .ojsc-clickable-day {
    box-shadow: inset 0 3px 0 0 hsl(220, 100%, 50%);
}

.ojsc-day-art .ojsc-clickable-day {
    box-shadow: inset 0 3px 0 0 hsl(280, 100%, 50%);
}

/* For 1-day view header */
.ojsc-day-work .ojsc-day-card-header:not(.ojsc-clickable-day) {
    border-top: 3px solid hsl(30, 100%, 50%);
    padding-top: 3px; /* Add padding to prevent text from touching the line */
}
.ojsc-day-skills .ojsc-day-card-header:not(.ojsc-clickable-day) {
    border-top: 3px solid hsl(220, 100%, 50%);
    padding-top: 3px;
}
.ojsc-day-art .ojsc-day-card-header:not(.ojsc-clickable-day) {
    border-top: 3px solid hsl(280, 100%, 50%);
    padding-top: 3px;
}

/* --- Time Toggle Feature Styles --- */

/* Active state for the 'Time' button */
.ojsc-calendar-header button.ojsc-button-active {
    background-color: var(--text-accent);
    color: var(--text-on-accent);
    border-color: var(--text-accent);
}

/* Layout for tasks with time to stack time and text */
.ojsc-task-with-time .internal-link {
    display: flex;
    flex-direction: column;
    line-height: 1.2;
}

/* Style for the task time text */
.ojsc-task-time {
    color: var(--text-accent);
    font-weight: 500;
}

/* --- Participants Toggle Feature Styles --- */
.ojsc-task-item .internal-link {
    display: flex;
    flex-direction: column;
    line-height: 1.2;
}

.ojsc-task-participants {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin-top: 2px;
    margin-bottom: 2px;
}

.ojsc-task-participants .internal-link {
    font-size: 0.9em;
    color: var(--text-accent);
    background-color: hsla(270, 60%, 70%, 0.2);
    padding: 1px 4px;
    border-radius: 3px;
}

/* --- Wikilinks Toggle Feature Styles --- */
.ojsc-task-wikilinks {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin-top: 2px;
    margin-bottom: 2px;
}

.ojsc-task-wikilinks .internal-link {
    font-size: 0.9em;
    color: var(--text-accent);
    background-color: hsla(270, 60%, 70%, 0.2);
    padding: 1px 4px;
    border-radius: 3px;
}

.ojsc-hide-wikilinks .ojsc-task-wikilinks {
    display: none;
}


/* --- Main Action Buttons (Scroll, Bulk Mode) --- */
.ojsc-scroll-to-top,
.ojsc-bulk-mode-btn {
    position: fixed;
    z-index: 1000;
    width: 48px;
    height: 48px;
    background-color: #555;
    color: white;
    cursor: pointer;
    border-radius: 50%; /* Reverted to circle */
    border: none;
    font-size: 20px;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.ojsc-scroll-to-top {
    bottom: 60px;
    right: 30px;
    opacity: 0;
    visibility: hidden;
}

.ojsc-bulk-mode-btn {
    bottom: 60px;
    left: 30px;
}

.ojsc-scroll-to-top.visible {
    opacity: 1;
    visibility: visible;
}

.ojsc-scroll-to-top:hover,
.ojsc-bulk-mode-btn:hover {
    background-color: #777; /* Subtle hover effect */
}

.ojsc-bulk-mode-btn.active {
    background-color: var(--text-accent);
}


/* --- Bulk Operations Status Buttons --- */
/* Container for bulk action buttons */
.ojsc-bulk-actions-container {
    position: fixed;
    bottom: 60px;
    left: 88px;
    z-index: 1000;
    display: flex;
    gap: 10px;
}

/* Base style for all bulk action buttons */
.ojsc-bulk-set-in-progress-btn,
.ojsc-bulk-set-done-btn,
.ojsc-bulk-set-cancel-btn,
.ojsc-bulk-set-postpone-btn {
    width: 44px;
    height: 44px;
    border: 1px solid var(--background-modifier-border);
    outline: none;
    background-color: var(--background-secondary);
    color: var(--text-normal);
    cursor: pointer;
    border-radius: 8px;
    font-size: 20px;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease, border-color 0.3s ease;
}

.ojsc-bulk-set-in-progress-btn.visible,
.ojsc-bulk-set-done-btn.visible,
.ojsc-bulk-set-cancel-btn.visible,
.ojsc-bulk-set-postpone-btn.visible {
    opacity: 1;
    visibility: visible;
}

.ojsc-bulk-set-in-progress-btn:hover,
.ojsc-bulk-set-done-btn:hover,
.ojsc-bulk-set-cancel-btn:hover,
.ojsc-bulk-set-postpone-btn:hover {
    border-color: var(--text-accent); /* Subtle border highlight on hover */
}

/* Individual button colors and font sizes */
.ojsc-bulk-set-in-progress-btn {
    color: gold;
}

.ojsc-bulk-set-done-btn,
.ojsc-bulk-set-cancel-btn {
    font-size: 22px;
}

.ojsc-bulk-set-postpone-btn {
    color: #2196F3;
}


/* Visual indicator for the entire calendar when in bulk mode */
.ojsc-container.ojsc-bulk-mode {
    background-color: rgba(var(--text-accent-rgb), 0.05);
}

/* Make the highlighting much more prominent */
.ojsc-bulk-mode .ojsc-calendar-header,
.ojsc-bulk-mode .ojsc-weekday,
.ojsc-bulk-mode .ojsc-day-card {
    border: 1px dashed var(--text-accent);
    transition: border 0.3s ease;
}

.ojsc-bulk-mode .ojsc-month-grid-card.ojsc-other-month {
    opacity: 0.6;
}

/* --- Task Item Area Colors --- */
/* Generated based on OJSC.config.areaColors and threshold logic */
.ojsc-task-item.ojsc-area-Work { background-color: hsla(30,100%,50%,0.1); border-left: 3px solid hsl(30,100%,50%); }
.ojsc-task-item.ojsc-area-Work .internal-link { color: hsl(30,100%,75%); }

.ojsc-task-item.ojsc-area-Skills { background-color: hsla(220,100%,50%,0.1); border-left: 3px solid hsl(220,100%,50%); }
.ojsc-task-item.ojsc-area-Skills .internal-link { color: hsl(220,100%,75%); }

.ojsc-task-item.ojsc-area-Optimization { background-color: hsla(0,0%,100%,0.2); border-left: 3px solid hsl(0,0%,100%); }
.ojsc-task-item.ojsc-area-Optimization .internal-link { color: hsl(0,0%,100%); }

.ojsc-task-item.ojsc-area-Matter { background-color: hsla(120,100%,50%,0.1); border-left: 3px solid hsl(120,100%,50%); }
.ojsc-task-item.ojsc-area-Matter .internal-link { color: hsl(120,100%,75%); }

.ojsc-task-item.ojsc-area-Health { background-color: hsla(150,72%,42%,0.1); border-left: 3px solid hsl(150,72%,42%); }
.ojsc-task-item.ojsc-area-Health .internal-link { color: hsl(150,72%,75%); }

.ojsc-task-item.ojsc-area-Housekeep { background-color: hsla(75,100%,50%,0.1); border-left: 3px solid hsl(75,100%,50%); }
.ojsc-task-item.ojsc-area-Housekeep .internal-link { color: hsl(75,100%,75%); }

.ojsc-task-item.ojsc-area-Art { background-color: hsla(280,100%,50%,0.1); border-left: 3px solid hsl(280,100%,50%); }
.ojsc-task-item.ojsc-area-Art .internal-link { color: hsl(280,100%,75%); }

.ojsc-task-item.ojsc-area-Spirit { background-color: hsla(330,100%,88%,0.2); border-left: 3px solid hsl(330,100%,88%); }
.ojsc-task-item.ojsc-area-Spirit .internal-link { color: hsl(330,100%,88%); }

.ojsc-task-item.ojsc-area-Social { background-color: hsla(200,100%,70%,0.2); border-left: 3px solid hsl(200,100%,70%); }
.ojsc-task-item.ojsc-area-Social .internal-link { color: hsl(200,100%,70%); }

.ojsc-task-item.ojsc-area-Fun { background-color: hsla(60,100%,50%,0.1); border-left: 3px solid hsl(60,100%,50%); }
.ojsc-task-item.ojsc-area-Fun .internal-link { color: hsl(60,100%,75%); }

/* Style for important tasks without an area */
.ojsc-task-item.ojsc-task-important-no-area { background-color: hsla(0, 80%, 50%, 0.2); border-left: 3px solid hsl(0, 80%, 50%); }
.ojsc-task-item.ojsc-task-important-no-area .internal-link { color: hsl(0, 80%, 75%); }


/* Style for selected task items in bulk mode */
.ojsc-task-item.ojsc-task-item-selected {
    background-color: var(--text-accent) !important;
    color: var(--text-on-accent) !important;
    border-left-color: var(--text-on-accent) !important;
}

.ojsc-task-item.ojsc-task-item-selected .internal-link,
.ojsc-task-item.ojsc-task-item-selected .ojsc-task-time {
    color: var(--text-on-accent) !important;
}

/* Change cursor for tasks in bulk mode */
.ojsc-bulk-mode .ojsc-task-item {
    cursor: pointer;
}

/* Change cursor for day cards in bulk mode */
.ojsc-bulk-mode .ojsc-day-card {
    cursor: crosshair; /* Indicate it's a drop target */
}
